<app-title-w-line [title]="'Campagnes'"></app-title-w-line>
<div class="boutons">
  <button mat-raised-button [routerLink]="['/espace-commercial/campagne/enregistrer']" class="btn-add">Créer une
    campagne
  </button>
  <div class="toggle">
    <div>
      Toutes
      <mat-slide-toggle color="primary" [checked]="onlyActiveCampaigns" (change)="swapFilter()">
        Campagnes actives
      </mat-slide-toggle>
    </div>
  </div>
</div>

<form class="filtres">
  @for (filtre of filtres; track filtre) {
    <app-filter [filterName]="filtre. name" [filterControl]="filtreControls[filtre. control]"
                [filterOptions]="filtre. options" [filterType]="filtre. type"></app-filter>
  }
</form>

<div class="mat-elevation-z3">
  <table mat-table [dataSource]="dataSource" matSort>
    @if (this.onlyActiveCampaigns) {
      <ng-container matColumnDef="completion">
        <mat-header-cell *matHeaderCellDef mat-sort-header> %</mat-header-cell>
        <mat-cell *matCellDef="let element">
          {{ completionCampagnesMap.get(element.campagne) || 0 }} %
        </mat-cell>
      </ng-container>
    }
    <ng-container matColumnDef="campagne">
      <mat-header-cell *matHeaderCellDef mat-sort-header> Campagne</mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.campagne }}</mat-cell>
    </ng-container>
    <ng-container matColumnDef="libelle">
      <mat-header-cell *matHeaderCellDef mat-sort-header> Libellé</mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.libelle }}</mat-cell>
    </ng-container>
    <ng-container matColumnDef="auteur">
      <mat-header-cell *matHeaderCellDef mat-sort-header> Auteur</mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.user }}</mat-cell>
    </ng-container>
    <ng-container matColumnDef="date">
      <mat-header-cell *matHeaderCellDef mat-sort-header> Date</mat-header-cell>
      <mat-cell *matCellDef="let element"> du {{ element.datedeb }} au {{ element.datefin }}</mat-cell>
    </ng-container>
    <ng-container matColumnDef="nbSocietes">
      <mat-header-cell *matHeaderCellDef mat-sort-header> Nombre de sociétés</mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.nbrSocietes }}</mat-cell>
    </ng-container>
    <ng-container matColumnDef="nbCalls">
      <mat-header-cell *matHeaderCellDef mat-sort-header> Nombre d'appels réalisés</mat-header-cell>
      <mat-cell *matCellDef="let element"> {{ element.nbrapl }}</mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumns;"
             [routerLink]="['/espace-commercial/campagne/'+row.campagne]" class="cell"></mat-row>
    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell" colspan="4">Aucune campagne en cours</td>
    </tr>
  </table>
</div>
